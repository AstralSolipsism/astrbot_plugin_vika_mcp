# 维格表MCP插件使用示例 v3.0

本文档展示了维格表MCP插件v3.0的智能化功能和实际使用场景。用户只需用自然语言描述需求，大模型会自动调用相应的维格表工具。

## 🚀 v3.0 智能化功能

### 1. 自动数据表发现

#### 首次使用 - 自动同步
```
用户：我想查看我的数据表
AI：我来帮您同步并查看可用的数据表。

[AI自动调用 sync_vika_datasheets 工具]

✅ 同步完成！共发现 8 个数据表。

📋 **已发现的数据表**：
• 员工信息管理表 (`dst1234567890abcdef`)
• 项目管理跟踪表 (`dst0987654321fedcba`)
• 客户关系管理表 (`dstabcdef1234567890`)
• 产品信息库 (`dstfedcba0987654321`)
• 订单管理系统 (`dst5678901234abcdef`)
• ... 还有 3 个数据表

💡 现在您可以直接通过数据表名称来操作它们了！
```

#### 查看空间站列表
```
用户：我有哪些维格表空间站？
AI：让我为您查询可用的空间站。

[AI自动调用 list_vika_spaces 工具]

🏢 **您的维格表空间站** (共 2 个)：

• **公司管理空间** 🔸 *默认*
  ID: `spc1234567890abcdef`

• **个人项目空间**
  ID: `spc0987654321fedcba`

💡 **提示**: 当前使用的是"公司管理空间"作为默认空间站。
```

#### 筛选查看数据表
```
用户：看看有哪些包含"管理"的数据表
AI：我来为您筛选包含"管理"的数据表。

[AI自动调用 list_vika_datasheets 工具]
参数：filter_keyword="管理"

📊 **数据表列表** (包含 '管理') (共 4 个)：

• **员工信息管理表**
  ID: `dst1234567890abcdef`

• **项目管理跟踪表**
  ID: `dst0987654321fedcba`

• **客户关系管理表**
  ID: `dstabcdef1234567890`

• **订单管理系统**
  ID: `dst5678901234abcdef`

💡 **提示**: 您可以直接使用数据表名称进行操作，系统会自动识别。
```

### 2. 智能表名匹配

#### 模糊匹配示例
```
用户：查询员工表的信息
AI：我理解您想查询"员工信息管理表"的信息。

[AI自动匹配到 "员工信息管理表" 并调用 get_vika_records 工具]

找到 25 条记录：

| 姓名 | 部门 | 职位 | 工号 | 入职日期 |
|---|---|---|---|---|
| 张三 | 技术部 | 高级工程师 | E001 | 2022-01-15 |
| 李四 | 产品部 | 产品经理 | P002 | 2022-03-20 |
...
```

#### 自定义别名示例
```
配置文件中设置：
custom_aliases:
  "员工": "员工信息管理表"
  "项目": "项目管理跟踪表"

用户：添加一个新员工到员工表
AI：我来为您在员工信息管理表中添加新员工。

[AI通过别名匹配，自动识别目标表]
```

### 3. 一键创建数据表

#### 简单创建
```
用户：帮我创建一个客户满意度调研表
AI：我来为您创建客户满意度调研表。

[AI自动调用 create_vika_datasheet 工具]
参数：
- name="客户满意度调研表"
- description="用于收集和分析客户满意度数据"

✅ 数据表创建成功！

📊 **数据表名称**: 客户满意度调研表
🆔 **数据表ID**: `dstnew1234567890abc`
🏢 **所在空间站**: 公司管理空间

💡 数据表已添加到缓存，您可以直接通过名称操作它。
```

#### 带字段配置创建
```
用户：创建一个任务管理表，包含任务名称、负责人、优先级、状态、截止日期字段
AI：我来为您创建包含指定字段的任务管理表。

[AI自动调用 create_vika_datasheet 工具]
参数：
- name="任务管理表"
- description="项目任务跟踪和管理"
- fields_config='[{"name":"任务名称","type":"SingleLineText"},{"name":"负责人","type":"SingleLineText"},{"name":"优先级","type":"SingleSelect"},{"name":"状态","type":"SingleSelect"},{"name":"截止日期","type":"Date"}]'

✅ 数据表创建成功！

📊 **数据表名称**: 任务管理表
🆔 **数据表ID**: `dsttask1234567890`
🏢 **所在空间站**: 公司管理空间
📝 **描述**: 项目任务跟踪和管理
📋 **字段数量**: 5 个

💡 数据表已添加到缓存，您可以直接通过名称操作它。
```

## 基础数据操作（优化版）

### 1. 查询数据

#### 场景：查看员工信息
```
用户：帮我看看员工表里都有哪些员工
AI：我来为您查询员工表的信息。

[AI自动调用 get_vika_records 工具]
参数：datasheet_name="员工表"

找到 15 条记录：

| 姓名 | 部门 | 职位 | 工号 | 入职日期 |
|---|---|---|---|---|
| 张三 | 技术部 | 高级工程师 | E001 | 2022-01-15 |
| 李四 | 产品部 | 产品经理 | P002 | 2022-03-20 |
| 王五 | 设计部 | UI设计师 | D003 | 2022-05-10 |
| ... | ... | ... | ... | ... |

总共找到15名员工的信息。
```

#### 场景：条件查询
```
用户：查询技术部的所有员工
AI：我来查询技术部的员工信息。

[AI自动调用 get_vika_records 工具]
参数：
- datasheet_name="员工表"
- filter_formula="部门='技术部'"

找到 6 条记录：

| 姓名 | 部门 | 职位 | 工号 |
|---|---|---|---|
| 张三 | 技术部 | 高级工程师 | E001 |
| 赵六 | 技术部 | 前端工程师 | E004 |
| 钱七 | 技术部 | 后端工程师 | E007 |
| ... | ... | ... | ... |

技术部共有6名员工。
```

#### 场景：限制数量查询
```
用户：给我看看项目表的前3个项目
AI：我来为您查询项目表的前3个项目。

[AI自动调用 get_vika_records 工具]
参数：
- datasheet_name="项目表"
- max_records=3

找到 3 条记录（显示前 3 条）：

| 项目名称 | 负责人 | 状态 | 开始日期 |
|---|---|---|---|
| 电商平台升级 | 张三 | 进行中 | 2024-01-15 |
| 移动APP开发 | 李四 | 规划中 | 2024-02-01 |
| 数据分析系统 | 王五 | 已完成 | 2023-12-01 |

这是项目表中的前3个项目。
```

### 2. 添加数据

#### 场景：添加新员工
```
用户：在员工表中添加一个新员工：姓名叫孙八，部门是市场部，职位是销售专员，工号是M008
AI：我来为您在员工表中添加这名新员工。

[AI自动调用 add_vika_record 工具]
参数：
- datasheet_name="员工表"
- record_data="姓名=孙八,部门=市场部,职位=销售专员,工号=M008"

成功添加记录，记录ID: rec1234567890abcdef

新员工孙八已成功添加到员工表中！
```

#### 场景：使用JSON格式添加
```
用户：给项目表加个新项目，项目名称是"客户管理系统"，负责人是"李四"，状态是"规划中"，预算是50000
AI：我来为您添加这个新项目。

[AI自动调用 add_vika_record 工具]
参数：
- datasheet_name="项目表"
- record_data='{"项目名称":"客户管理系统","负责人":"李四","状态":"规划中","预算":50000}'

成功添加记录，记录ID: rec0987654321fedcba

新项目"客户管理系统"已成功添加到项目表中！
```

### 3. 搜索数据

#### 场景：关键词搜索
```
用户：在员工表中搜索所有姓张的员工
AI：我来搜索姓张的员工信息。

[AI自动调用 search_vika_records 工具]
参数：
- datasheet_name="员工表"
- search_query="张"

搜索关键词 '张' 的结果：

找到 2 条记录：

| 姓名 | 部门 | 职位 | 工号 |
|---|---|---|---|
| 张三 | 技术部 | 高级工程师 | E001 |
| 张明 | 财务部 | 会计师 | F005 |

找到2名姓张的员工。
```

#### 场景：指定字段搜索
```
用户：在项目表中搜索负责人是李四的项目
AI：我来搜索李四负责的项目。

[AI自动调用 search_vika_records 工具]
参数：
- datasheet_name="项目表"
- search_query="李四"
- search_fields="负责人"

搜索关键词 '李四' 的结果：

找到 3 条记录：

| 项目名称 | 负责人 | 状态 | 开始日期 |
|---|---|---|---|
| 移动APP开发 | 李四 | 规划中 | 2024-02-01 |
| 客户管理系统 | 李四 | 规划中 | 2024-06-19 |
| 报表系统优化 | 李四 | 进行中 | 2024-05-15 |

李四当前负责3个项目。
```

### 4. 更新数据

#### 场景：更新员工信息
```
用户：把员工表中记录ID为rec1234567890abcdef的员工职位改为"高级销售专员"
AI：我来为您更新该员工的职位信息。

[AI自动调用 update_vika_record 工具]
参数：
- datasheet_name="员工表"
- record_id="rec1234567890abcdef"
- update_data="职位=高级销售专员"

成功更新记录 rec1234567890abcdef

员工职位已成功更新为"高级销售专员"。
```

#### 场景：更新项目状态
```
用户：将项目表中的"客户管理系统"项目状态改为"进行中"，记录ID是rec0987654321fedcba
AI：我来更新该项目的状态。

[AI自动调用 update_vika_record 工具]
参数：
- datasheet_name="项目表"
- record_id="rec0987654321fedcba"
- update_data='{"状态":"进行中","开始日期":"2024-06-19"}'

成功更新记录 rec0987654321fedcba

"客户管理系统"项目状态已更新为"进行中"。
```

### 5. 删除数据

#### 场景：删除记录
```
用户：删除员工表中记录ID为rec1111111111111111的记录
AI：我来为您删除指定的员工记录。

[AI自动调用 delete_vika_record 工具]
参数：
- datasheet_name="员工表"
- record_id="rec1111111111111111"

成功删除记录 rec1111111111111111

指定的员工记录已成功删除。
```

## 表结构管理

### 1. 查看字段信息

```
用户：看看员工表有哪些字段
AI：我来为您查询员工表的字段结构。

[AI自动调用 get_vika_fields 工具]
参数：datasheet_name="员工表"

数据表 '员工表' 的字段信息：

• **姓名** (类型: SingleLineText) - 员工姓名
• **部门** (类型: SingleSelect) - 所属部门
• **职位** (类型: SingleLineText) - 职位名称
• **工号** (类型: SingleLineText) - 员工编号
• **入职日期** (类型: Date) - 入职时间
• **联系电话** (类型: PhoneNumber) - 联系方式
• **邮箱** (类型: Email) - 电子邮箱
• **薪资** (类型: Number) - 薪资数额

员工表包含8个字段，涵盖了员工的基本信息。
```

### 2. 检查插件状态

```
用户：检查一下维格表插件的连接状态
AI：我来检查维格表插件的当前状态。

[AI自动调用 get_vika_status 工具]

维格表MCP插件状态：

✅ 客户端连接: 正常
🔑 API Token: 已配置 (ustk1234...)
🌐 服务器地址: https://api.vika.cn
📊 默认数据表: dst1234567890abcdef
📋 数据表别名映射:
  • 员工表 → dst1234567890abcdef
  • 项目表 → dst0987654321fedcba
  • 客户表 → dstabcdef1234567890
  • 产品表 → dstfedcba0987654321

维格表插件运行正常，所有配置都已就绪。
```

## 复合场景应用

### 场景1：员工入职流程

```
用户：新员工王小明今天入职，部门是研发部，职位是Java工程师，工号是R009，请帮我添加到员工表
AI：我来为新员工王小明办理入职登记。

[AI自动调用 add_vika_record 工具]
参数：
- datasheet_name="员工表"
- record_data="姓名=王小明,部门=研发部,职位=Java工程师,工号=R009,入职日期=2024-06-19"

成功添加记录，记录ID: rec2222222222222222

新员工王小明已成功添加到员工表中，入职手续已完成！

用户：帮我看看研发部现在有多少人了
AI：我来查询研发部的员工数量。

[AI自动调用 get_vika_records 工具]
参数：
- datasheet_name="员工表"
- filter_formula="部门='研发部'"

找到 8 条记录：

研发部目前有8名员工，包括刚刚入职的王小明。
```

### 场景2：项目管理流程

```
用户：我想了解一下当前所有进行中的项目情况
AI：我来为您查询当前进行中的项目。

[AI自动调用 get_vika_records 工具]
参数：
- datasheet_name="项目表"
- filter_formula="状态='进行中'"

找到 4 条记录：

| 项目名称 | 负责人 | 开始日期 | 预算 |
|---|---|---|---|
| 电商平台升级 | 张三 | 2024-01-15 | 100000 |
| 客户管理系统 | 李四 | 2024-06-19 | 50000 |
| 数据分析平台 | 王五 | 2024-05-01 | 80000 |
| 移动端优化 | 赵六 | 2024-06-10 | 30000 |

当前有4个项目正在进行中。

用户：给"移动端优化"项目分配一个新成员王小明
AI：我需要先找到"移动端优化"项目的记录ID，然后更新项目成员信息。

[AI自动调用 search_vika_records 工具]
参数：
- datasheet_name="项目表"
- search_query="移动端优化"

[然后自动调用 update_vika_record 工具更新项目信息]

项目成员已成功更新，王小明已加入"移动端优化"项目团队。
```

### 场景3：数据分析与报告

```
用户：帮我分析一下各部门的人员分布情况
AI：我来为您分析各部门的人员分布。

[AI自动调用 get_vika_records 工具]
参数：datasheet_name="员工表"

[AI分析返回的数据并生成报告]

根据员工表数据分析，各部门人员分布如下：

📊 **部门人员分布统计**
- 技术部：6人 (40%)
- 产品部：3人 (20%)
- 设计部：2人 (13.3%)
- 市场部：2人 (13.3%)
- 财务部：1人 (6.7%)
- 人事部：1人 (6.7%)

**总计：15人**

**分析结论：**
- 技术部人员最多，占比40%，符合技术导向型公司特点
- 产品部和设计部配比合理
- 支持部门（财务、人事）人员精简

用户：再看看技术部员工的具体情况
AI：我来详细查询技术部员工信息。

[AI自动调用前面已查询的数据或重新查询]

技术部6名员工详情：
- 2名高级工程师
- 2名前端工程师  
- 1名后端工程师
- 1名全栈工程师

技术团队结构合理，覆盖了前后端开发需求。
```

## 错误处理示例

### 配置错误
```
用户：查询一下员工信息
AI：抱歉，维格表插件配置有问题。

[AI自动调用 get_vika_status 工具检查状态]

维格表MCP插件状态：
❌ 客户端连接: 未建立
🔑 API Token: 未配置

请联系管理员配置维格表API Token后再试。
```

### 权限错误
```
用户：在员工表中添加新记录
AI：[尝试调用 add_vika_record 工具]

添加维格表记录失败: Permission denied. API token does not have write permission for this datasheet.

抱歉，当前API Token没有写入权限，无法添加记录。请联系管理员检查权限设置。
```

### 数据格式错误
```
用户：更新记录，数据是：姓名张三部门技术部
AI：[AI识别数据格式问题并给出建议]

数据格式不正确。请使用以下格式之一：
1. 键值对格式：`姓名=张三,部门=技术部`
2. JSON格式：`{"姓名":"张三","部门":"技术部"}`

请重新提供正确格式的数据。
```

## 总结

维格表MCP插件通过智能的自然语言处理，让用户无需记忆复杂的指令格式，只需用日常语言描述需求即可完成各种数据操作。插件支持完整的CRUD功能，并具备强大的搜索和分析能力，是提高工作效率的绝佳工具。
